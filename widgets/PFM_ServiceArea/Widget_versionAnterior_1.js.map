{"version":3,"sources":["../../../widgets/PFM_ServiceArea/Widget_versionAnterior_1.js"],"names":["define","declare","BaseWidget","SpatialReference","FeatureSet","ServiceAreaTask","ServiceAreaParameters","QueryTask","Query","Point","SimpleFillSymbol","SimpleLineSymbol","SimpleMarkerSymbol","Graphic","Color","baseClass","postCreate","inherited","arguments","console","log","onOpen","miMapa","map","i","itemInfo","itemData","operationalLayers","length","misCapas","miCapa","push","on","evento","graphics","clear","miSimbolo","STYLE_SQUARE","STYLE_SOLID","miPunto","mapPoint","x","y","spatialReference","ubicacion","add","entidades","ubicaciones","features","tareaAreaDeServicio","parametrosAreaDeServicio","intervalo1","dojo","byId","value","intervalo2","intervalo3","facilities","defaultBreaks","outSpatialReference","returnFacilities","impedanceAttribute","solve","resultado","simboloPoligono","forEach","serviceAreaPolygons","areaServicio","setSymbol","poligonoConsulta","geometry","setExtent","getExtent","consulta","where","outFields","returnGeometry","miURLConsulta","url","simbolo","itemProperties","layerDefinition","drawingInfo","renderer","symbol","miTareaDeConsulta","execute","geometria","simboloGenerico","punto","err","message"],"mappings":"AAAAA,OAAO,CACL,oBADK,EAEL,iBAFK,EAIL,uBAJK,EAKL,uBALK,EAML,4BANK,EAOL,kCAPK,EAQL,sBARK,EASL,kBATK,EAWL,qBAXK,EAYL,+BAZK,EAaL,+BAbK,EAcL,iCAdK,EAeL,cAfK,EAgBL,YAhBK,CAAP,EAiBG,UACDC,OADC,EAEDC,UAFC,EAIDC,gBAJC,EAKDC,UALC,EAMDC,eANC,EAODC,qBAPC,EAQDC,SARC,EASDC,KATC,EAWDC,KAXC,EAYDC,gBAZC,EAaDC,gBAbC,EAcDC,kBAdC,EAeDC,OAfC,EAgBDC,KAhBC,EAiBC;AACF;AACA,WAAOb,QAAQ,CAACC,UAAD,CAAR,EAAsB;;AAE3B;;AAEAa,mBAAW,kBAJgB;AAK3B;AACA;AACA;;AAEA;AACAC,oBAAY,sBAAW;AACrB,iBAAKC,SAAL,CAAeC,SAAf;AACAC,oBAAQC,GAAR,CAAY,6BAAZ;AACD,SAb0B;;AAe3B;AACA;AACA;AACA;;AAEAC,gBAAQ,kBAAU;AAChBF,oBAAQC,GAAR,CAAY,yBAAZ;;AAEA,gBAAIE,SAAS,KAAKC,GAAlB;AACAJ,oBAAQC,GAAR,CAAYE,MAAZ;;AAEA;AACA;;AAEA,iBAAK,IAAIE,IAAI,CAAb,EAAgBA,IAAIF,OAAOG,QAAP,CAAgBC,QAAhB,CAAyBC,iBAAzB,CAA2CC,MAA/D,EAAuEJ,GAAvE,EAA4E;;AAE1E,oBAAIK,WAAW,EAAf;AACAV,wBAAQC,GAAR,CAAY,mBAAZ,EAAiCU,MAAjC;;AAEA,oBAAIN,IAAI,CAAR,EAAW;AACTK,6BAASE,IAAT,CAAcT,OAAOG,QAAP,CAAgBC,QAAhB,CAAyBC,iBAAzB,CAA2CH,CAA3C,CAAd;AACD;AAEF;;AAED;;AAEAF,mBAAOU,EAAP,CAAU,OAAV,EAAmB,UAASC,MAAT,EAAgB;;AAEjCX,uBAAOY,QAAP,CAAgBC,KAAhB;;AAEA,oBAAIC,YAAY,IAAIxB,kBAAJ,CACZA,mBAAmByB,YADP,EAEZ,EAFY,EAGZ,IAAI1B,gBAAJ,CAAqBA,iBAAiB2B,WAAtC,EAAmD,IAAIxB,KAAJ,CAAU,CAAC,CAAD,EAAG,CAAH,EAAK,CAAL,CAAV,CAAnD,EAAuE,CAAvE,CAHY,EAIZ,IAAIA,KAAJ,CAAU,CAAC,CAAD,EAAG,CAAH,EAAK,CAAL,CAAV,CAJY,CAAhB;;AAOA,oBAAIyB,UAAU,IAAI9B,KAAJ,CAAUwB,OAAOO,QAAP,CAAgBC,CAA1B,EAA6BR,OAAOO,QAAP,CAAgBE,CAA7C,EAAgDpB,OAAOqB,gBAAvD,CAAd;;AAEA,oBAAIC,YAAY,IAAI/B,OAAJ,CAAY0B,OAAZ,EAAqBH,SAArB,CAAhB;AACAd,uBAAOY,QAAP,CAAgBW,GAAhB,CAAoBD,SAApB;;AAEA,oBAAIE,YAAY,EAAhB;AACAA,0BAAUf,IAAV,CAAea,SAAf;;AAEA,oBAAIG,cAAc,IAAI3C,UAAJ,EAAlB;AACA2C,4BAAYC,QAAZ,GAAuBF,SAAvB;;AAEA3B,wBAAQC,GAAR,CAAY2B,WAAZ;;AAEAE,sCAAsB,IAAI5C,eAAJ,CAAoB,+GAApB,CAAtB;;AAEA6C,2CAA2B,IAAI5C,qBAAJ,EAA3B;;AAEA,oBAAI6C,aAAaC,KAAKC,IAAL,CAAU,YAAV,EAAwBC,KAAzC;AACA,oBAAIC,aAAaH,KAAKC,IAAL,CAAU,YAAV,EAAwBC,KAAzC;AACA,oBAAIE,aAAaJ,KAAKC,IAAL,CAAU,YAAV,EAAwBC,KAAzC;;AAEAJ,yCAAyBO,UAAzB,GAAsCV,WAAtC;AACAG,yCAAyBQ,aAAzB,GAAyC,CAACP,UAAD,EAAaI,UAAb,EAAyBC,UAAzB,CAAzC;AACAN,yCAAyBS,mBAAzB,GAA+CrC,OAAOqB,gBAAtD;AACAO,yCAAyBU,gBAAzB,GAA4C,KAA5C;AACAV,yCAAyBW,kBAAzB,GAA8C,QAA9C;;AAEA1C,wBAAQC,GAAR,CAAY,0BAAZ,EAAwC8B,wBAAxC;;AAEAD,oCAAoBa,KAApB,CAA0BZ,wBAA1B,EAAoD,UAASa,SAAT,EAAmB;;AAErEzC,2BAAOY,QAAP,CAAgBC,KAAhB;;AAEAhB,4BAAQC,GAAR,CAAY,aAAZ,EAA2B2C,SAA3B;;AAEA,wBAAIC,kBAAkB,IAAItD,gBAAJ,CAClB,OADkB,EAElB,IAAIC,gBAAJ,CAAqB,OAArB,EAA8B,IAAIG,KAAJ,CAAU,CAAC,GAAD,EAAK,GAAL,EAAS,GAAT,CAAV,CAA9B,EAAwD,CAAxD,CAFkB,EAGlB,IAAIA,KAAJ,CAAU,CAAC,GAAD,EAAK,CAAL,EAAO,CAAP,EAAS,IAAT,CAAV,CAHkB,CAAtB;;AAMAsC,yBAAKa,OAAL,CAAaF,UAAUG,mBAAvB,EAA2C,UAASC,YAAT,EAAsB;;AAE/DhD,gCAAQC,GAAR,CAAY,0CAAZ,EAAwD+C,YAAxD;;AAEAA,qCAAaC,SAAb,CAAuBJ,eAAvB;AACA1C,+BAAOY,QAAP,CAAgBW,GAAhB,CAAoBsB,YAApB;AAED,qBAPD;;AASA,wBAAIE,mBAAmBN,UAAUG,mBAAV,CAA8B,CAA9B,EAAiCI,QAAxD;AACAhD,2BAAOiD,SAAP,CAAiBF,iBAAiBG,SAAjB,EAAjB,EAA+C,IAA/C;;AAEA,wBAAIC,WAAW,IAAIjE,KAAJ,EAAf;AACAiE,6BAASC,KAAT,GAAiB,KAAjB;AACAD,6BAASE,SAAT,GAAqB,CAAC,GAAD,CAArB;AACAF,6BAASH,QAAT,GAAoBD,gBAApB;AACAI,6BAASG,cAAT,GAA0B,IAA1B;AACAH,6BAASd,mBAAT,GAA+B,IAAIxD,gBAAJ,CAAqB,MAArB,CAA/B;;AAEA,yBAAK,IAAIqB,IAAI,CAAb,EAAgBA,IAAIF,OAAOG,QAAP,CAAgBC,QAAhB,CAAyBC,iBAAzB,CAA2CC,MAA/D,EAAuEJ,GAAvE,EAA4E;;AAE1E,4BAAIqD,gBAAgBvD,OAAOG,QAAP,CAAgBC,QAAhB,CAAyBC,iBAAzB,CAA2CH,CAA3C,EAA8CsD,GAAlE;;AAEA,4BAAIC,UAAUzD,OAAOG,QAAP,CAAgBC,QAAhB,CAAyBC,iBAAzB,CAA2C,CAA3C,EAA8CqD,cAA9C,CAA6DC,eAA7D,CAA6EC,WAA7E,CAAyFC,QAAzF,CAAkGC,MAAhH;;AAEA,4BAAIC,oBAAoB,IAAI9E,SAAJ,CAAcsE,aAAd,CAAxB;;AAEAQ,0CAAkBC,OAAlB,CAA0Bb,QAA1B,EAAoC,UAASV,SAAT,EAAoB;;AAEtD5C,oCAAQC,GAAR,CAAY,6BAAZ,EAA2C2C,SAA3C;;AAEA,gCAAIA,UAAUf,QAAV,CAAmBpB,MAAnB,GAA4B,CAAhC,EAAmC;;AAEjC,qCAAK,IAAIJ,IAAI,CAAb,EAAgBA,IAAIuC,UAAUf,QAAV,CAAmBpB,MAAvC,EAA+CJ,GAA/C,EAAmD;;AAEjD,wCAAI+D,YAAYxB,UAAUf,QAAV,CAAmBxB,CAAnB,EAAsB8C,QAAtC;;AAEA,wCAAIkB,kBAAkB,IAAI5E,kBAAJ,CACpBA,mBAAmByB,YADC,EAEpB,EAFoB,EAGpB,IAAI1B,gBAAJ,CAAqBA,iBAAiB2B,WAAtC,EAAmD,IAAIxB,KAAJ,CAAU,CAAC,CAAD,EAAG,CAAH,EAAK,CAAL,CAAV,CAAnD,EAAuE,CAAvE,CAHoB,EAIpB,IAAIA,KAAJ,CAAU,CAAC,CAAD,EAAG,CAAH,EAAK,CAAL,CAAV,CAJoB,CAAtB;;AAOA2E,4CAAQ,IAAI5E,OAAJ,CAAY0E,SAAZ,EAAuBC,eAAvB,CAAR;;AAEAlE,2CAAOY,QAAP,CAAgBW,GAAhB,CAAoB4C,KAApB;AAED;AAEF,6BAnBD,MAmBO;AACL;AACD;AAEF,yBA3BD;AA4BD;AAEF,iBArED,EAqEG,UAASC,GAAT,EAAa;AACdvE,4BAAQC,GAAR,CAAYsE,IAAIC,OAAhB;AACD,iBAvED;AAyEH,aAjHC;;AAoHF;;AAGC;;AAED;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;;AA/L2B,KAAtB,CAAP;AAmMD,CAvOD","file":"Widget_versionAnterior_1.js","sourcesContent":["define([\r\n  'dojo/_base/declare', \r\n  'jimu/BaseWidget',\r\n\r\n  \"esri/SpatialReference\",\r\n  \"esri/tasks/FeatureSet\",\r\n  \"esri/tasks/ServiceAreaTask\",\r\n  \"esri/tasks/ServiceAreaParameters\",\r\n  \"esri/tasks/QueryTask\",\r\n  \"esri/tasks/query\",\r\n\r\n  \"esri/geometry/Point\",\r\n  \"esri/symbols/SimpleFillSymbol\",\r\n  \"esri/symbols/SimpleLineSymbol\",\r\n  \"esri/symbols/SimpleMarkerSymbol\",\r\n  \"esri/graphic\", \r\n  \"esri/Color\",\r\n], function(\r\n  declare, \r\n  BaseWidget,\r\n  \r\n  SpatialReference,\r\n  FeatureSet,\r\n  ServiceAreaTask,\r\n  ServiceAreaParameters,\r\n  QueryTask,\r\n  Query,\r\n\r\n  Point,\r\n  SimpleFillSymbol,\r\n  SimpleLineSymbol,\r\n  SimpleMarkerSymbol,\r\n  Graphic,\r\n  Color,\r\n  ) {\r\n  //To create a widget, you need to derive from BaseWidget.\r\n  return declare([BaseWidget], {\r\n\r\n    // Custom widget code goes here\r\n\r\n    baseClass: 'pfm-service-area',\r\n    // this property is set by the framework when widget is loaded.\r\n    // name: 'PFM_ServiceArea',\r\n    // add additional properties here\r\n\r\n    //methods to communication with app container:\r\n    postCreate: function() {\r\n      this.inherited(arguments);\r\n      console.log('PFM_ServiceArea::postCreate');\r\n    },\r\n\r\n    // startup: function() {\r\n    //   this.inherited(arguments);\r\n    //   console.log('PFM_ServiceArea::startup');\r\n    // },\r\n\r\n    onOpen: function(){\r\n      console.log('PFM_ServiceArea::onOpen');\r\n\r\n      var miMapa = this.map;\r\n      console.log(miMapa);\r\n\r\n      // var miMapaURL = miMapa.url;\r\n      // console.log(miMapaURL);\r\n\r\n      for (var i = 0; i < miMapa.itemInfo.itemData.operationalLayers.length; i++) {\r\n\r\n        var misCapas = [];\r\n        console.log(\"La capa iterada: \", miCapa);\r\n\r\n        if (i > 1) {\r\n          misCapas.push(miMapa.itemInfo.itemData.operationalLayers[i]);\r\n        }\r\n\r\n      };\r\n\r\n      // miMapa.\r\n\r\n      miMapa.on(\"click\", function(evento){\r\n\r\n        miMapa.graphics.clear();\r\n\r\n        var miSimbolo = new SimpleMarkerSymbol(\r\n            SimpleMarkerSymbol.STYLE_SQUARE, \r\n            10,\r\n            new SimpleLineSymbol(SimpleLineSymbol.STYLE_SOLID, new Color([0,0,0]), 1),\r\n            new Color([0,0,0])\r\n        );\r\n\r\n        var miPunto = new Point(evento.mapPoint.x, evento.mapPoint.y, miMapa.spatialReference);\r\n\r\n        var ubicacion = new Graphic(miPunto, miSimbolo);\r\n        miMapa.graphics.add(ubicacion);       \r\n\r\n        var entidades = [];\r\n        entidades.push(ubicacion);\r\n\r\n        var ubicaciones = new FeatureSet();\r\n        ubicaciones.features = entidades\r\n\r\n        console.log(ubicaciones);\r\n\r\n        tareaAreaDeServicio = new ServiceAreaTask(\"https://localhost:6443/arcgis/rest/services/PFM/20210315_pruebaPublicarServiciosRutas/NAServer/Service%20Area\");\r\n\r\n        parametrosAreaDeServicio = new ServiceAreaParameters();\r\n\r\n        var intervalo1 = dojo.byId(\"intervalo1\").value;\r\n        var intervalo2 = dojo.byId(\"intervalo2\").value;\r\n        var intervalo3 = dojo.byId(\"intervalo3\").value;\r\n\r\n        parametrosAreaDeServicio.facilities = ubicaciones;\r\n        parametrosAreaDeServicio.defaultBreaks = [intervalo1, intervalo2, intervalo3];\r\n        parametrosAreaDeServicio.outSpatialReference = miMapa.spatialReference;\r\n        parametrosAreaDeServicio.returnFacilities = false;\r\n        parametrosAreaDeServicio.impedanceAttribute = \"Length\";\r\n\r\n        console.log(\"parametrosAreaDeServicio\", parametrosAreaDeServicio);\r\n\r\n        tareaAreaDeServicio.solve(parametrosAreaDeServicio, function(resultado){\r\n\r\n          miMapa.graphics.clear();\r\n\r\n          console.log(\"resultados:\", resultado);\r\n            \r\n          var simboloPoligono = new SimpleFillSymbol(\r\n              \"solid\",  \r\n              new SimpleLineSymbol(\"solid\", new Color([255,255,255]), 1),\r\n              new Color([255,0,0,0.25])\r\n          );\r\n            \r\n          dojo.forEach(resultado.serviceAreaPolygons,function(areaServicio){\r\n\r\n            console.log(\"Añadiendo polígono de area de servicio: \", areaServicio);\r\n\r\n            areaServicio.setSymbol(simboloPoligono);\r\n            miMapa.graphics.add(areaServicio);\r\n\r\n          });\r\n\r\n          var poligonoConsulta = resultado.serviceAreaPolygons[0].geometry;\r\n          miMapa.setExtent(poligonoConsulta.getExtent(), true);\r\n\r\n          var consulta = new Query();\r\n          consulta.where = \"1=1\";\r\n          consulta.outFields = [\"*\"];\r\n          consulta.geometry = poligonoConsulta;\r\n          consulta.returnGeometry = true;\r\n          consulta.outSpatialReference = new SpatialReference(102100);\r\n\r\n          for (var i = 0; i < miMapa.itemInfo.itemData.operationalLayers.length; i++) {\r\n          \r\n            var miURLConsulta = miMapa.itemInfo.itemData.operationalLayers[i].url;\r\n\r\n            var simbolo = miMapa.itemInfo.itemData.operationalLayers[0].itemProperties.layerDefinition.drawingInfo.renderer.symbol;\r\n\r\n            var miTareaDeConsulta = new QueryTask(miURLConsulta);\r\n\r\n            miTareaDeConsulta.execute(consulta, function(resultado) {\r\n\r\n              console.log(\"Resultado de la querytask: \", resultado);\r\n\r\n              if (resultado.features.length > 0) {\r\n\r\n                for (var i = 0; i < resultado.features.length; i++){\r\n\r\n                  var geometria = resultado.features[i].geometry;\r\n\r\n                  var simboloGenerico = new SimpleMarkerSymbol(\r\n                    SimpleMarkerSymbol.STYLE_SQUARE, \r\n                    10,\r\n                    new SimpleLineSymbol(SimpleLineSymbol.STYLE_SOLID, new Color([0,0,0]), 1),\r\n                    new Color([0,0,0])\r\n                  );\r\n\r\n                  punto = new Graphic(geometria, simboloGenerico);\r\n\r\n                  miMapa.graphics.add(punto);\r\n\r\n                }\r\n                  \r\n              } else {\r\n                return;\r\n              }\r\n\r\n            })\r\n          }\r\n\r\n        }, function(err){\r\n          console.log(err.message);\r\n        });       \r\n\r\n    });\r\n\r\n\r\n    // itemInfo.itemData.operationalLayers[0].itemProperties.layerDefinition.drawingInfo.renderer.symbol\r\n\r\n\r\n    },\r\n\r\n    // onClose: function(){\r\n    //   console.log('PFM_ServiceArea::onClose');\r\n    // },\r\n\r\n    // onMinimize: function(){\r\n    //   console.log('PFM_ServiceArea::onMinimize');\r\n    // },\r\n\r\n    // onMaximize: function(){\r\n    //   console.log('PFM_ServiceArea::onMaximize');\r\n    // },\r\n\r\n    // onSignIn: function(credential){\r\n    //   console.log('PFM_ServiceArea::onSignIn', credential);\r\n    // },\r\n\r\n    // onSignOut: function(){\r\n    //   console.log('PFM_ServiceArea::onSignOut');\r\n    // }\r\n\r\n    // onPositionChange: function(){\r\n    //   console.log('PFM_ServiceArea::onPositionChange');\r\n    // },\r\n\r\n    // resize: function(){\r\n    //   console.log('PFM_ServiceArea::resize');\r\n    // }\r\n\r\n    //methods to communication between widgets:\r\n\r\n  });\r\n\r\n});\r\n"]}